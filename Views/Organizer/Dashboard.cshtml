@model OnlineTicket.ViewModels.OrganizerDashboardViewModel

@{
    ViewData["Title"] = "Organizer Dashboard";
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="bg-green-100 text-green-800 p-3 rounded mb-4 flex justify-between items-center">
        <span>@TempData["SuccessMessage"]</span>
        <button type="button" class="ml-4 font-bold" onclick="this.parentElement.style.display='none'">×</button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="bg-red-100 text-red-800 p-3 rounded mb-4 flex justify-between items-center">
        <span>@TempData["ErrorMessage"]</span>
        <button type="button" class="ml-4 font-bold" onclick="this.parentElement.style.display='none'">×</button>
    </div>
}

<!-- Header Section -->
<div class="bg-gradient-to-r from-indigo-100 to-indigo-50 p-6 rounded-xl mb-8 shadow-md flex flex-col md:flex-row md:justify-between md:items-center gap-4">
    <div>
        <h1 class="text-3xl md:text-4xl font-bold text-indigo-600 flex items-center gap-2">
            <i class="fa-solid fa-tachometer-alt"></i> @Model.OrganizerName's Dashboard
        </h1>
        <p class="text-gray-600 mt-1">Overview of your StarEvents platform performance.</p>
    </div>
    <div class="flex gap-2 flex-wrap">
        <a asp-controller="Account" asp-action="EditAccount" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
            <i class="fa-solid fa-user-edit mr-2"></i> Edit Your Account
        </a>
        <a asp-controller="Organizer" asp-action="Events" class="inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            <i class="fa-solid fa-calendar-check mr-2"></i> Manage Events
        </a>
    </div>
</div>

<!-- Top Summary Cards (Modern & Smart) -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">

    <!-- Total Events Card -->
    <div class="bg-gradient-to-r from-indigo-50 to-indigo-100 p-6 rounded-xl shadow hover:shadow-xl transition border-l-4 border-indigo-500 flex flex-col justify-between">
        <div class="flex items-center gap-4">
            <div class="bg-indigo-200 p-3 rounded-full text-indigo-600">
                <i class="fa-solid fa-calendar-days fa-lg"></i>
            </div>
            <div>
                <p class="text-gray-500 font-medium">Total Events</p>
                <p class="text-3xl font-extrabold mt-1">@Model.TotalEvents</p>
            </div>
        </div>
        <div class="mt-4">
            <div class="w-full bg-indigo-200 h-1.5 rounded-full overflow-hidden">
                <div class="bg-indigo-500 h-1.5 animate-pulse" style="width:@(Math.Min(@Model.TotalEvents * 5,100))%"></div>
            </div>
            <a asp-controller="Organizer" asp-action="Events" class="text-indigo-600 hover:text-indigo-800 text-sm mt-2 inline-block">View All Events &rarr;</a>
        </div>
    </div>

    <!-- Tickets Sold Card -->
    <div class="bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-xl shadow hover:shadow-xl transition border-l-4 border-green-500 flex flex-col justify-between">
        <div class="flex items-center gap-4">
            <div class="bg-green-200 p-3 rounded-full text-green-600">
                <i class="fa-solid fa-ticket fa-lg"></i>
            </div>
            <div>
                <p class="text-gray-500 font-medium">Tickets Sold</p>
                <p class="text-3xl font-extrabold mt-1">@Model.TotalTicketsSoldAllTime</p>
            </div>
        </div>
        <div class="mt-4">
            <div class="w-full bg-green-200 h-1.5 rounded-full overflow-hidden">
                <div class="bg-green-500 h-1.5 animate-pulse" style="width:@(Math.Min(@Model.TotalTicketsSoldAllTime * 2,100))%"></div>
            </div>
            <span class="text-green-600 text-xs mt-2 block">All-time count</span>
        </div>
    </div>

    <!-- Total Revenue Card -->
    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-6 rounded-xl shadow hover:shadow-xl transition border-l-4 border-yellow-500 flex flex-col justify-between">
        <div class="flex items-center gap-4">
            <div class="bg-yellow-200 p-3 rounded-full text-yellow-600">
                <i class="fa-solid fa-coins fa-lg"></i>
            </div>
            <div>
                <p class="text-gray-500 font-medium">Total Revenue</p>
                <p class="text-3xl font-extrabold mt-1">@Model.TotalRevenueAllTime.ToString("C")</p>
            </div>
        </div>
        <div class="mt-4">
            <div class="w-full bg-yellow-200 h-1.5 rounded-full overflow-hidden">
                <div class="bg-yellow-500 h-1.5 animate-pulse" style="width:@(Math.Min((int)@Model.TotalRevenueAllTime / 1000,100))%"></div>
            </div>
            <a asp-controller="Organizer"
               asp-action="OrganizerSalesReport"
               asp-route-organizerId="@Model.OrganizerId"
               class="text-yellow-600 hover:text-yellow-800 text-sm mt-2 inline-block">
                View Sales Report →
            </a>
        </div>
    </div>

</div>


<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- Upcoming Events -->
    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Upcoming Events (@Model.UpcomingEvents.Count)</h2>
            <a asp-controller="Organizer" asp-action="CreateEvent" class="inline-flex items-center bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                <i class="fa-solid fa-plus mr-1"></i> New Event
            </a>
        </div>

        @if (Model.UpcomingEvents.Any())
        {
            <ul class="divide-y divide-gray-100">
                @foreach (var ev in Model.UpcomingEvents.Take(5))
                {
                    <li class="flex justify-between items-center py-3 px-2 hover:bg-gray-50 rounded-lg transition">
                        <div>
                            <p class="font-medium text-indigo-600">@ev.Title</p>
                            <p class="text-sm text-gray-500">@ev.EventDate.ToString("MMM dd, yyyy @ hh:mm tt")</p>
                        </div>
                        <div class="text-right flex flex-col items-end">
                            <p class="text-sm font-semibold text-green-600">@ev.TotalTicketsSold Sold</p>
                            <div class="flex gap-2 mt-1">
                                <a asp-controller="Organizer" asp-action="EditEvent" asp-route-id="@ev.EventId" class="text-xs text-indigo-400 hover:text-indigo-600">Edit</a>
                                <a asp-controller="Organizer" asp-action="AddTicketTypes" asp-route-eventId="@ev.EventId" class="text-xs text-indigo-400 hover:text-indigo-600">Tickets</a>
                            </div>
                        </div>
                    </li>
                }
            </ul>

            @if (Model.UpcomingEvents.Count > 5)
            {
                <div class="mt-4 text-center">
                    <a asp-controller="Organizer" asp-action="Events" class="text-sm text-indigo-500 hover:text-indigo-700">See all upcoming events</a>
                </div>
            }
        }
        else
        {
            <p class="text-gray-500 italic">No upcoming events scheduled. Create your first event!</p>
        }
    </div>

    <!-- Revenue Breakdown -->
    <div class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Revenue Breakdown (Top 5)</h2>

        @if (Model.RevenuePerEvent.Any())
        {
            @foreach (var ev in Model.RevenuePerEvent.Take(5))
            {
                <div class="mb-4">
                    <div class="flex justify-between mb-1 text-sm">
                        <span class="font-medium text-gray-700">@ev.Title</span>
                        <span class="font-bold text-gray-800">@ev.TotalRevenue.ToString("C0")</span>
                    </div>
                    @{
                        decimal maxRevenue = Model.RevenuePerEvent.Max(e => e.TotalRevenue);
                        int widthPct = maxRevenue > 0 ? (int)(ev.TotalRevenue / maxRevenue * 100) : 0;
                    }
                    <div class="w-full bg-gray-200 h-2.5 rounded-full">
                        <div class="bg-indigo-400 h-2.5 rounded-full" style="width: @(widthPct)%"></div>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-gray-500 italic text-sm">Revenue data will appear here once events are sold.</p>
        }
    </div>

    <!-- Promotion Management Card -->
    <div class="bg-white p-6 rounded-xl shadow mt-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Promotions</h2>

            <a asp-controller="Organizer" asp-action="AddPromotion"
               class="inline-flex items-center bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-indigo-700 transition">
                <i class="fa-solid fa-plus mr-1"></i> New Promotion
            </a>
        </div>

        <p class="text-gray-600 text-sm mb-4">
            Manage discount campaigns to boost your event ticket sales.
        </p>

        <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
            <div class="flex justify-between items-center">
                <div>
                    <p class="font-medium text-indigo-700">Current Active Promotions</p>
                    <p class="text-2xl font-bold text-indigo-600">
                        @Model.ActivePromotionsCount
                    </p>
                </div>

                <div class="bg-indigo-200 p-3 rounded-full text-indigo-700">
                    <i class="fa-solid fa-tags fa-lg"></i>
                </div>
            </div>

            <a asp-controller="Organizer" asp-action="Promotions"
               class="block text-sm text-indigo-600 mt-4 hover:text-indigo-800 transition">
                View All Promotions →
            </a>
        </div>

    </div>

    <!-- Edit Account Card -->
    <div class="bg-white p-4 rounded-xl shadow hover:shadow-lg transition border-l-4 border-indigo-500">
        <div class="flex justify-between items-center mb-3">
            <div>
                <h2 class="text-lg font-semibold text-gray-800">Your Profile</h2>
                <p class="text-gray-500 text-sm">Manage your organizer details: Name, Address, Contact Information</p>
            </div>
            <div class="bg-indigo-100 p-3 rounded-full text-indigo-600">
                <i class="fa-solid fa-user-cog fa-lg"></i>
            </div>
        </div>
        <a asp-controller="Organizer" asp-action="EditProfile"
           class="inline-flex items-center justify-center w-full mt-5 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
            <i class="fa-solid fa-edit mr-2"></i> Edit Profile
        </a>
    </div>

</div>
