@model IEnumerable<OnlineTicket.Models.Event>

<div class="max-w-7xl mx-auto p-6">

    <!-- Heading Section -->
    <div class="mb-8 flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="text-center w-full md:w-auto">
            <h1 class="text-5xl md:text-6xl font-extrabold text-indigo-600 mb-3 drop-shadow-lg hover:text-indigo-800 transition duration-300">
                Your Events
            </h1>
            <p class="text-lg md:text-xl text-gray-600 font-medium hover:text-gray-700 transition duration-300">
                Manage your events and ticket types efficiently. Use the filters to quickly find what you need.
            </p>
        </div>

        <a asp-action="CreateEvent" asp-controller="Organizer"
           class="mt-4 md:mt-0 inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition shadow-xl font-semibold text-lg">
            <i class="fa-solid fa-plus mr-2"></i> Add New Event
        </a>
    </div>


    <!-- TempData Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="bg-green-100 text-green-800 p-3 rounded mb-4 flex justify-between items-center shadow">
            <span>@TempData["SuccessMessage"]</span>
            <button type="button" class="ml-4 font-bold text-lg" onclick="this.parentElement.style.display='none'">×</button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="bg-red-100 text-red-800 p-3 rounded mb-4 flex justify-between items-center shadow">
            <span>@TempData["ErrorMessage"]</span>
            <button type="button" class="ml-4 font-bold text-lg" onclick="this.parentElement.style.display='none'">×</button>
        </div>
    }

    <!-- Filter Form -->
    <form id="filterForm" method="get" class="flex flex-wrap gap-4 mb-6 items-end">
        <div>
            <input type="text" name="search" value="@ViewBag.Search" placeholder="Search by title"
                   class="form-input px-3 py-2 rounded border w-full sm:w-64" />
        </div>

        <div>
            <select name="CategoryId" asp-items="ViewBag.CategoryList" class="form-select px-3 py-2 rounded border w-full sm:w-48">
                <option value="">All Categories</option>
            </select>
        </div>

        <div>
            <select name="VenueId" asp-items="ViewBag.VenueList" class="form-select px-3 py-2 rounded border w-full sm:w-48">
                <option value="">All Venues</option>
            </select>
        </div>

        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Filter</button>
        <button type="button" onclick="clearFilters()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition">
            Clear
        </button>
    </form>

    <!-- Event Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var ev in Model)
        {
            <div class="bg-white shadow-lg rounded-xl overflow-hidden hover:shadow-2xl transition relative">
                <!-- Event Banner -->
                <div class="h-40 w-full relative">
                    @if (!string.IsNullOrEmpty(ev.ImagePath))
                    {
                        <img src="@ev.ImagePath" class="w-full h-full object-cover" />
                    }
                    else
                    {
                        <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-500 font-semibold">
                            No Image
                        </div>
                    }
                </div>

                <!-- Event Info -->
                <div class="p-4 space-y-2">
                    <h2 class="text-xl font-bold text-indigo-600">@ev.Title</h2>
                    <p class="text-gray-500 text-sm">@ev.Category?.Name • @ev.Venue?.Name</p>
                    <p class="text-gray-600 text-sm">
                        <i class="fa-solid fa-calendar-days mr-1"></i> @ev.EventDate.ToString("MMM dd, yyyy @ hh:mm tt")
                    </p>
                    <p class="text-gray-600 text-sm">
                        <i class="fa-solid fa-ticket mr-1"></i>
                        Tickets Sold: @(ev.Tickets?.Count ?? 0) / @(ev.TotalSeats)
                    </p>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between items-center p-4 border-t border-gray-200 gap-2">
                    <a href="@Url.Action("EditEvent", "Organizer", new { id = ev.EventId })"
                       class="flex-1 px-3 py-2 bg-yellow-400 text-white text-center rounded hover:bg-yellow-500 transition">Edit</a>

                    <form asp-action="DeleteEventConfirmed" asp-controller="Organizer" method="post" onsubmit="return confirm('Are you sure you want to delete this event?');" class="flex-1">
                        <input type="hidden" name="id" value="@ev.EventId" />
                        @Html.AntiForgeryToken()
                        <button type="submit" class="w-full px-3 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
                    </form>

                    <a href="@Url.Action("AddTicketTypes", "Organizer", new { eventId = ev.EventId })"
                       class="flex-1 px-3 py-2 bg-green-600 text-white text-center rounded hover:bg-green-700 transition">Tickets</a>
                </div>
            </div>
        }
    </div>

    <!-- Pagination -->
    <div class="mt-6 flex justify-center gap-2">
        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <a href="?page=@i&search=@ViewBag.Search&categoryId=@ViewBag.CategoryId&venueId=@ViewBag.VenueId&status=@ViewBag.Status"
               class="px-3 py-1 rounded @(i == ViewBag.Page ? "bg-blue-600 text-white" : "bg-gray-200")">
                @i
            </a>
        }
    </div>

    <!-- Back to Dashboard -->
    <div class="mt-6 text-center">
        <h2 class="text-xl font-semibold text-gray-700 mb-2">Need to return to your main dashboard?</h2>
        <p class="text-gray-500 mb-3">Click below to go back and manage other aspects of your organizer account.</p>
        <a asp-action="Dashboard" asp-controller="Organizer"
           class="inline-flex items-center px-4 py-2 border rounded text-gray-700 hover:bg-gray-100 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> Back to Dashboard
        </a>
    </div>
</div>

@section Scripts {
    <script>
        function clearFilters() {
            const form = document.getElementById('filterForm');
            if (!form) return;
            form.querySelectorAll('input, select').forEach(el => {
                if (el.type === 'text') el.value = '';
                else if (el.tagName === 'SELECT') el.selectedIndex = 0;
            });
            form.submit();
        }
    </script>
}
