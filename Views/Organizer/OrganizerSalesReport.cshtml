@model OnlineTicket.ViewModels.OrganizerSalesReportVM
@{
    ViewData["Title"] = "Organizer Sales Report";
}

<div class="max-w-7xl mx-auto p-6">

    <!-- Heading Section -->
    <div class="bg-white shadow-md rounded-xl p-6 mb-8 border-l-4 border-indigo-600">
        <h1 class="text-3xl font-bold text-indigo-700 mb-2 flex items-center">
            <i class="fa-solid fa-chart-line mr-3"></i>
            Sales Report for @Model.OrganizerName
        </h1>

        <p class="text-gray-600 text-lg">
            View a detailed breakdown of ticket sales, monthly performance trends, and
            total revenue generated per event.
        </p>

        <!-- Back Link -->
        <a asp-action="Dashboard"
           asp-route-organizerId="@Model.OrganizerId"
           class="inline-block mt-4 text-indigo-600 hover:text-indigo-800 font-medium">
            ← Back to Your Dashboard
        </a>
    </div>

    <!-- Event-wise Sales Charts -->
    @foreach (var ev in Model.EventSales)
    {
        <div class="bg-white p-6 rounded-xl shadow mb-10">
            <h2 class="text-2xl font-semibold text-gray-800 mb-3 flex items-center">
                <i class="fa-solid fa-ticket mr-2 text-indigo-600"></i> @ev.EventName
            </h2>

            <p class="text-gray-700 mb-4 font-medium">
                Total Revenue:
                <span class="text-green-600 font-bold">@ev.TotalRevenue.ToString("C")</span>
            </p>

            <!-- Chart -->
            <canvas id="chart-@ev.EventName.Replace(" ", "")" class="h-64 w-full"></canvas>

            <script>
                var ctx = document.getElementById('chart-@ev.EventName.Replace(" ", "")').getContext('2d');

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [@string.Join(", ", ev.MonthlyTicketSales.Select(ms => $"'{ms.Month}'"))],
                        datasets: [{
                            label: 'Tickets Sold',
                            data: [@string.Join(", ", ev.MonthlyTicketSales.Select(ms => ms.TicketsSold))],
                            backgroundColor: 'rgba(99, 102, 241, 0.7)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: true }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            </script>
        </div>
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
}
