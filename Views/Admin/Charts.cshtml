@model OnlineTicket.ViewModels.AdminDashboardVM
@{
    ViewData["Title"] = "Charts";
}

<div class="max-w-7xl mx-auto p-6">

    <!-- Page Heading -->
    <div class="mb-8">
        <h1 class="text-4xl font-extrabold text-indigo-600 mb-2">Revenue Analytics of Each Organizer</h1>
        <p class="text-gray-600 text-lg">View monthly revenue generated by each organizer for better business insights.</p>
    </div>

    <div class="bg-white p-6 rounded-xl shadow mb-8">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">Revenue Per Month (By Organizer)</h2>
        <canvas id="revenuePerMonthChart" class="h-64 w-full"></canvas>
    </div>

    <!-- Back Button -->
    <div class="flex justify-start">
        <a asp-action="Dashboard" asp-controller="Admin"
           class="inline-flex items-center px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">
            <i class="fa-solid fa-arrow-left mr-2"></i> Back to Dashboard
        </a>
    </div>

</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const revenueData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.RevenuePerMonthByOrganizer));
        const monthLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const organizers = [...new Set(revenueData.map(r => r.OrganizerName))];

        const colors = [
            'rgba(99,102,241,0.7)',
            'rgba(16,185,129,0.7)',
            'rgba(234,179,8,0.7)',
            'rgba(239,68,68,0.7)',
            'rgba(37,99,235,0.7)',
            'rgba(139,92,246,0.7)'
        ];

        const datasets = organizers.map((org, i) => {
            const data = monthLabels.map((_, idx) => {
                const month = idx + 1;
                const record = revenueData.find(r => r.OrganizerName === org && r.Month === month);
                return record ? record.Revenue : 0;
            });
            return {
                label: org,
                data: data,
                backgroundColor: colors[i % colors.length],
                borderColor: colors[i % colors.length],
                borderWidth: 1
            };
        });

        const ctx = document.getElementById('revenuePerMonthChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: { labels: monthLabels, datasets: datasets },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true, ticks: { callback: value => '$' + value.toLocaleString() } }
                }
            }
        });
    </script>
}
