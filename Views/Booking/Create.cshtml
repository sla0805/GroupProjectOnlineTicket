@model OnlineTicket.Models.BookingCreateVM

@{
    ViewData["Title"] = "Book Event";
}

<link rel="stylesheet" href="~/css/booking.css" />

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-xl-10">

            <div class="card modern-card">
                <div class="row g-0">

                    <div class="col-lg-5">
                        <div class="event-image-container">
                            <img src="@(ViewBag.EventImage ?? "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?auto=format&fit=crop&q=80&w=600")"
                                 class="event-img-cover"
                                 alt="@Model.EventTitle" />

                            <div class="event-overlay">
                                <span class="badge bg-primary mb-2 shadow-sm">Event Details</span>
                                <h3 class="fw-bold mb-1">@Model.EventTitle</h3>
                                <div class="d-flex align-items-center mt-2 text-white-50 small">
                                    <i class="bi bi-geo-alt me-1"></i> @(ViewBag.VenueName ?? "Venue TBA")
                                </div>
                                <div class="d-flex align-items-center mt-1 text-white-50 small">
                                    <i class="bi bi-calendar3 me-1"></i> @(((DateTime?)ViewBag.EventDate)?.ToString("MMM dd, yyyy • hh:mm tt") ?? "Date TBA")
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-7">
                        <div class="card-body p-4 p-md-5">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="fw-bold text-dark mb-0">Book Your Tickets</h4>
                                <div class="text-muted small">Step 1 of 2</div>
                            </div>

                            <form asp-action="Create" method="post">
                                <input type="hidden" asp-for="EventId" />
                                <input type="hidden" asp-for="EventTitle" />

                                <div class="mb-4">
                                    <label class="form-label text-muted small fw-bold text-uppercase mb-2 ps-1">Select Ticket Class</label>

                                    <div class="ticket-selector-grid">
                                        @foreach (var tt in Model.TicketTypes)
                                        {
                                            <div class="position-relative">
                                                <input type="radio"
                                                       asp-for="TicketTypeId"
                                                       value="@tt.TicketTypeId"
                                                       class="btn-check"
                                                       id="ticket_@tt.TicketTypeId"
                                                       required />

                                                <label class="ticket-option-card" for="ticket_@tt.TicketTypeId">
                                                    <i class="bi bi-check-circle-fill check-icon"></i>

                                                    <div>
                                                        <div class="ticket-name">@tt.Name</div>
                                                        <div class="ticket-price">@tt.Price.ToString("C")</div>
                                                    </div>

                                                    <div class="ticket-info">
                                                        @if (tt.TotalSeats < 10 && tt.TotalSeats > 0)
                                                        {
                                                            <span class="text-warning fw-bold"><i class="bi bi-exclamation-circle me-1"></i> Only @tt.TotalSeats left!</span>
                                                        }
                                                        else
                                                        {
                                                            <span><i class="bi bi-people me-1"></i> @tt.TotalSeats seats available</span>
                                                        }
                                                    </div>
                                                </label>
                                            </div>
                                        }
                                    </div>
                                    <span asp-validation-for="TicketTypeId" class="text-danger small"></span>
                                </div>

                                <div class="form-floating mb-4">
                                    <input asp-for="Quantity" type="number" class="form-control" id="qtyInput" min="1" value="1" placeholder="1" required />
                                    <label for="qtyInput">Quantity</label>
                                </div>

                                @if (Model.AvailablePromotions != null && Model.AvailablePromotions.Any())
                                {
                                    <div class="summary-box p-3 mb-4">
                                        <div class="d-flex align-items-center mb-2 text-primary fw-bold">
                                            <i class="bi bi-tags-fill me-2"></i> Have a promo code?
                                        </div>
                                        <div class="form-floating">
                                            <select asp-for="PromotionId" class="form-select bg-white border-0" id="promoSelect">
                                                <option value="">No Promotion applied</option>
                                                @foreach (var p in Model.AvailablePromotions)
                                                {
                                                    <option value="@p.PromotionId">@p.Name (-@p.DiscountPercentage.ToString("0")%)</option>
                                                }
                                            </select>
                                            <label for="promoSelect">Select Promotion</label>
                                        </div>
                                    </div>
                                }

                                <hr class="my-4 text-muted opacity-25">

                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a asp-controller="Event" asp-action="Index" asp-route-id="@Model.EventId" class="btn btn-light rounded-pill px-4 fw-bold">Cancel</a>
                                    <button type="submit" class="btn btn-primary-modern px-5">
                                        Confirm Booking <i class="bi bi-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>